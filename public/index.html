<!doctype html>

<html lang="id">
<head>
  <meta charset="utf-8" />
  <title>Recall Agent Trading ‚Äî Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- Navbar -->
  <header class="navbar">
    <h1>Recall Agent Trading</h1>
    <button id="toggle-dark" class="btn">üåô Dark Mode</button>
  </header>

  <main class="container">
    <!-- Manual Trade -->
    <section class="card">
      <h2>Manual Trade</h2>
      <form id="manual-trade-form" class="form-grid">
        <label>From Chain
          <select name="fromChain">
            <option value="EVM">EVM</option>
            <option value="SVM">SVM</option>
          </select>
        </label>
        <label>From Specific
          <input type="text" name="fromSpecific" placeholder="eth, sol, bnb..." />
        </label>
        <label>To Chain
          <select name="toChain">
            <option value="EVM">EVM</option>
            <option value="SVM">SVM</option>
          </select>
        </label>
        <label>To Specific
          <input type="text" name="toSpecific" placeholder="eth, base, arb..." />
        </label>
        <label>Action
          <select name="action">
            <option value="buy">Buy</option>
            <option value="sell">Sell</option>
          </select>
        </label>
        <label>From Token
          <input type="text" name="fromToken" placeholder="USDC, ETH..." />
        </label>
        <label>To Token
          <input type="text" name="toToken" placeholder="ETH, SOL..." />
        </label>
        <label>Amount
          <input type="number" step="0.01" name="amount" placeholder="10.5" required />
        </label>
        <label>Reason
          <input type="text" name="reason" placeholder="strategy / note" />
        </label>
        <button type="submit" class="btn primary">Submit Trade</button>
      </form>
      <pre id="manual-trade-output" class="trades"></pre>
    </section>

```
<!-- Quick Trade -->
<section class="card">
  <h2>Quick Trade</h2>
  <form id="quick-trade-form" class="form-grid">
    <label>From
      <select name="fromAsset">
        <option>ETH</option><option>BTC</option><option>BNB</option><option>ARB</option><option>SOL</option>
      </select>
    </label>
    <label>To
      <select name="toAsset">
        <option>ETH</option><option>BTC</option><option>BNB</option><option>ARB</option><option>SOL</option>
      </select>
    </label>
    <label>Action
      <select name="action">
        <option value="buy">Buy</option><option value="sell">Sell</option>
      </select>
    </label>
    <label>Amount
      <input type="number" step="0.01" name="amount" required />
    </label>
    <button type="submit" class="btn primary">Submit</button>
  </form>
  <div id="quick-trade-result" class="result-box">Belum ada transaksi.</div>
</section>

<!-- Bridge -->
<section class="card">
  <h2>Bridge (Simulate)</h2>
  <form id="bridge-form" class="form-grid">
    <label>From
      <input type="text" name="fromBridge" placeholder="eth, sol..." />
    </label>
    <label>To
      <input type="text" name="toBridge" placeholder="base, arb..." />
    </label>
    <label>Token
      <input type="text" name="token" placeholder="USDC" />
    </label>
    <label>Amount
      <input type="number" name="amount" step="0.01" />
    </label>
    <label>Reason
      <input type="text" name="reason" />
    </label>
    <button type="submit" class="btn primary">Submit</button>
  </form>
  <div id="bridge-result" class="result-box"></div>
</section>

<!-- Transaksi Sederhana -->
<section class="card">
  <h2>Transaksi Sederhana</h2>
  <form id="tx-form" class="form-grid">
    <label>Aset <input type="text" id="asset" required /></label>
    <label>Jumlah <input type="number" id="quantity" step="0.01" required /></label>
    <label>Harga <input type="number" id="price" step="0.01" required /></label>
    <label>Aksi
      <select id="action" required>
        <option value="buy">Buy</option><option value="sell">Sell</option>
      </select>
    </label>
    <button type="submit" class="btn primary">Submit Transaksi</button>
  </form>
  <div id="tx-result"></div>
</section>

<!-- Portfolio -->
<section class="card">
  <h2>Portfolio</h2>
  <button id="refresh-portfolio" class="btn">Refresh Portfolio</button>
  <table id="portfolio-table">
    <thead>
      <tr><th>Token</th><th>Balance</th><th>Chain</th><th>Last Updated</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</section>

<!-- Riwayat Transaksi -->
<section class="card">
  <h2>Riwayat Transaksi</h2>
  <table>
    <thead>
      <tr><th>ID</th><th>Asset</th><th>Jumlah</th><th>Harga</th><th>Aksi</th><th>Total</th><th>Waktu</th></tr>
    </thead>
    <tbody id="riwayat-body"></tbody>
  </table>
</section>

<!-- Trade History Recall -->
<section class="card">
  <h2>Trade History (Recall Competition)</h2>
  <table>
    <thead>
      <tr>
        <th>ID</th><th>Timestamp</th><th>Competition</th>
        <th>From ‚Üí To</th><th>Token</th><th>Amount</th><th>Action</th><th>Status</th>
      </tr>
    </thead>
    <tbody id="history-body"></tbody>
  </table>
</section>
```

  </main>

  <footer>
    <small>Local demo ‚Äî simulated execution. Integrate with Recall APIs for real trading/competitions.</small>
  </footer>

  <script src="app.js"></script>

  <script>
    // Dark Mode Toggle
    const darkToggle = document.getElementById("toggle-dark");
    darkToggle.addEventListener("click", () => {
      document.body.classList.toggle("dark");
      darkToggle.textContent = document.body.classList.contains("dark") ? "‚òÄÔ∏è Light Mode" : "üåô Dark Mode";
    });

    // Quick Trade
    const quickForm = document.getElementById("quick-trade-form");
    const quickResult = document.getElementById("quick-trade-result");
    quickForm.addEventListener("submit", e => {
      e.preventDefault();
      const payload = Object.fromEntries(new FormData(quickForm).entries());
      quickResult.textContent = `Trade Submitted: ${JSON.stringify(payload)}`;
    });

    // Transaksi Sederhana
    const txForm = document.getElementById("tx-form");
    const txResult = document.getElementById("tx-result");
    const riwayatBody = document.getElementById("riwayat-body");

    async function loadTransactions() {
      const res = await fetch("/api/transactions");
      const data = await res.json();
      riwayatBody.innerHTML = "";
      data.transactions.forEach(tx => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${tx.id}</td>
          <td>${tx.asset}</td>
          <td>${tx.quantity}</td>
          <td>${tx.price}</td>
          <td>${tx.action}</td>
          <td>${tx.total}</td>
          <td>${new Date(tx.timestamp).toLocaleString()}</td>
        `;
        riwayatBody.appendChild(row);
      });
    }

    txForm.addEventListener("submit", async e => {
      e.preventDefault();
      txResult.textContent = "Mengirim transaksi...";
      const payload = {
        asset: document.getElementById("asset").value,
        quantity: parseFloat(document.getElementById("quantity").value),
        price: parseFloat(document.getElementById("price").value),
        action: document.getElementById("action").value
      };
      try {
        const res = await fetch("/api/transaction", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        if (data.success) {
          txResult.textContent = "‚úÖ Transaksi berhasil!";
          loadTransactions();
        } else {
          txResult.textContent = `‚ùå Gagal: ${data.error}`;
        }
      } catch (err) {
        txResult.textContent = `‚ùå Error: ${err.message}`;
      }
    });
    loadTransactions();

    // Manual Trade
    const manualForm = document.getElementById("manual-trade-form");
    const manualOutput = document.getElementById("manual-trade-output");
    manualForm.addEventListener("submit", async e => {
      e.preventDefault();
      const payload = Object.fromEntries(new FormData(manualForm).entries());
      try {
        const res = await fetch("/manual-trade", {
          method: "POST", headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json();
        manualOutput.textContent = JSON.stringify(data, null, 2);

        const historyBody = document.getElementById("history-body");
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${data.id || "-"}</td>
          <td>${new Date().toLocaleString()}</td>
          <td>${payload.competitionId || "-"}</td>
          <td>${payload.fromSpecific} ‚Üí ${payload.toSpecific}</td>
          <td>${payload.fromToken}/${payload.toToken}</td>
          <td>${payload.amount}</td>
          <td>${payload.action}</td>
          <td>${data.success ? "‚úÖ success" : "‚ùå failed"}</td>
        `;
        historyBody.appendChild(row);
      } catch (err) {
        manualOutput.textContent = "Error: " + err.message;
      }
    });
  </script>

</body>
</html>
